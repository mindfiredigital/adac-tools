# ADAC - AWS Diagram As Code

ADAC is a comprehensive ecosystem for generating high-quality AWS architecture diagrams. It provides a powerful command-line interface (CLI), a developer-friendly core engine, and a modern Web UI for both programmatic and visual diagram creation.

## ðŸ“‚ Project Overview & Structure

The project is managed as a **pnpm monorepo**, ensuring modularity and clean separation of concerns.

### ðŸ“¦ Packages

| Package                                  | Description                     | Key Responsibilities                                                            |
| :--------------------------------------- | :------------------------------ | :------------------------------------------------------------------------------ |
| **`@mindfiredigital/adac-core`**         | The brain of the system.        | Orchestrates parsing, validation, and rendering. Bundles layout engines.        |
| **`@mindfiredigital/adac-diagram`**      | Distribution package for users. | Provides the `adac` CLI and a public API for web applications.                  |
| **`@mindfiredigital/adac-cli`**          | CLI Engine.                     | Handles command-line arguments and help text. Separated from the diagram logic. |
| **`@mindfiredigital/adac-parser`**       | YAML Logic.                     | Robust parsing of ADAC-formatted YAML files into structured data.               |
| **`@mindfiredigital/adac-schema`**       | Validation Layer.               | Formally defines the ADAC specification using JSON Schema.                      |
| **`@mindfiredigital/adac-layout-elk`**   | Professional Layout.            | Advanced graph positioning using `elkjs` algorithms.                            |
| **`@mindfiredigital/adac-layout-dagre`** | Simple Layout.                  | Lightweight alternative for hierarchical graph layouts.                         |
| **`@mindfiredigital/adac-icons-aws`**    | Assets.                         | Repository of over 1,600 AWS icons and tools to manage them.                    |
| **`@mindfiredigital/adac-web`**          | Frontend.                       | React-based visual editor with drag-and-drop and real-time preview.             |
| **`@mindfiredigital/adac-web-server`**   | API.                            | Express server that exposes diagram generation as a service.                    |

---

## ðŸš€ Local Setup

### Prerequisites

- **Node.js**: v20 or newer.
- **pnpm**: v9 or newer (`npm install -g pnpm`).

### Installation Steps

1.  **Clone the Repository**:
    ```bash
    git clone https://github.com/mindfiredigital/adac-tools.git
    cd adac-tools
    ```
2.  **Install All Dependencies**:
    ```bash
    pnpm install
    ```
3.  **Bootstrap Packages**:
    Compile the entire workspace to ensure all internal modules are linked:
    ```bash
    pnpm run build
    ```

---

## ðŸ›  Usage & Package Deep Dive

### 1. The `adac` CLI (`@mindfiredigital/adac-diagram`)

The CLI is the primary way to use ADAC programmatically.

- **Generate a Diagram**:
  ```bash
  pnpm cli diagram my-infra.yaml -o output.svg
  ```
- **Force Schema Validation**:
  ```bash
  pnpm cli diagram my-infra.yaml --validate
  ```
- **Schema Validation Only**:
  ```bash
  pnpm cli validate my-infra.yaml
  ```

### 2. Core Engine (`@mindfiredigital/adac-core`)

Use this package if you are building your own application that needs to generate diagrams.

```typescript
import { generateDiagramSvg } from '@mindfiredigital/adac-core';

const { svg } = await generateDiagramSvg(yamlFileContent, 'elk');
```

### 3. Web UI (`@mindfiredigital/adac-web`)

To run the visual editor:

```bash
cd packages/web
pnpm dev
```

---

## ðŸ“¦ Dependencies & Architecture Patterns

### Critical Patterns

- **Zero-Dependency Releases**: When `core` or `diagram` are built, they bundle all internal workspace dependencies (like `parser` and `layout`). This ensures that users installing via npm don't need to worry about internal mono-repo layout.
- **Embedded Assets**: Diagrams generated by ADAC embed icons directly as **Base64 URI** data. This makes the output SVG files fully portableâ€”they will render correctly anywhere without needing access to an external image folder.

### Key Third Party Libs

- **elkjs**: High-performance graph layout engine.
- **commander**: CLI argument parsing.
- **commander**: React Flow (for the visual editor).
- **ajv**: JSON Schema validation.

---

## ðŸ“œ Monorepo Scripts

| Command             | Action                                                                                                        |
| :------------------ | :------------------------------------------------------------------------------------------------------------ |
| `pnpm build`        | Compiles all packages in the workspace in topological order.                                                  |
| `pnpm test`         | Runs the test suite across all packages.                                                                      |
| `pnpm cli`          | Runs the ADAC CLI directly from the source.                                                                   |
| `pnpm setup:icons`  | Downloads and organizes the AWS icon set.                                                                     |
| `pnpm release:pack` | **Important**: Creates standalone `.tgz` release tarballs for `core` and `diagram` in the `releases/` folder. |
| `pnpm format`       | Runs Prettier across the entire codebase.                                                                     |

---

## ðŸ“‘ Special Folders & Files

When cloning this repo, pay attention to:

- **`/releases`**: Destination for standalone npm packages generated by `release:pack`. (Ignored by git).
- **`/yamls`**: Contains real-world example infrastructure files (`aws.adac.yaml`, `data_pipeline.adac.yaml`) used for testing.
- **`/scripts`**:
  - `pack-release.js`: The automation engine for creating production builds.
  - `generate_report.ts`: A tool that generates `report.html` to visually compare different layout engines.
- **`pnpm-workspace.yaml`**: Defines how the packages are linked during development.

---

## ðŸŽ“ Summary of Requirements Met

1.  **Core** is a bundleable npm package.
2.  **Core** uses `schema` for validation and `parser` for parsing.
3.  **Core** supports both `elk` and `dagre` layout strategies.
4.  **CLI** is decoupled into its own package for clean command management.
5.  **Diagram** provides both a CLI entry point and an npm module API.
6.  **Web Server** consumes the `diagram` package as a standard npm module.
